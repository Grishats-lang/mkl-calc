<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ Pro - –ü—Ä–æ—Å–º–æ—Ç—Ä</title>
    
    <!-- Highcharts -->
    <script src="js/highcharts.js"></script>
    <script src="js/gantt.js"></script>
    <script src="js/exporting.js"></script>
    <script src="js/modules/export-data.js"></script>
    <script src="js/accessibility.js"></script>
    
    <style>
        :root {
            --primary-blue: #0D47A1;
            --accent-teal: #00796B;
            --accent-orange: #EF6C00;
            --background-white: #FFFFFF;
            --text-primary: #212121;
            --text-secondary: #546E7A;
            --font-main: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            /* –°–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∏–ª—é */
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-teal) 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        /* –≠–∫—Ä–∞–Ω "–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" */
        #orientation-lock {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-blue);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #orientation-lock .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: rotate-phone 2s infinite ease-in-out;
        }

        @keyframes rotate-phone {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(0deg); }
        }

        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        @media screen and (max-width: 600px) and (orientation: portrait) {
            #orientation-lock { display: flex; }
            .container { display: none; }
        }
        
        /* –ö–Ω–æ–ø–∫–∞ "–Ø –≤—Å–µ —Ä–∞–≤–Ω–æ —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–∫" */
        .force-view-btn {
            margin-top: 20px;
            padding: 10px 20px;
            border: 1px solid white;
            background: transparent;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--font-main);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            background: var(--background-white);
            border-radius: 8px; /* –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ —É–≥–ª—ã */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            /* –í—ã—Å–æ—Ç–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ —ç–∫—Ä–∞–Ω–∞ –º–∏–Ω—É—Å –æ—Ç—Å—Ç—É–ø—ã */
            height: calc(100vh - 20px); 
            overflow: hidden;
            position: relative;
        }

        .header {
            background: var(--background-white);
            border-bottom: 1px solid #CFD8DC;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 18px;
            color: var(--primary-blue);
            font-weight: 700;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            display: flex;
            gap: 10px;
        }

        .btn-toggle {
            background: var(--background-light);
            border: 1px solid var(--primary-blue);
            color: var(--primary-blue);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-toggle:hover, .btn-toggle.active {
            background: var(--primary-blue);
            color: white;
        }

        /* –û–±–ª–∞—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–∞ */
        #ganttChart {
            flex-grow: 1;
            width: 100%;
            /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
            overflow-y: auto; 
            overflow-x: hidden;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 10px; align-items: flex-start; }
            .header h1 { font-size: 16px; }
            .controls { width: 100%; justify-content: space-between; }
            .btn-toggle { flex-grow: 1; text-align: center; }
        }
    </style>
</head>
<body>
    
        <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
    <div id="orientation-lock">
        <div class="icon">üì± ‚û°Ô∏è üîÑ</div>
        <h2>–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
        <p>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç –ª—É—á—à–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏.</p>
        <button class="force-view-btn" onclick="document.getElementById('orientation-lock').style.display='none'; document.querySelector('.container').style.display='flex';">
            –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ —Ä–∞–≤–Ω–æ
        </button>
    </div>

    <div class="container">
         <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ -->
        <div id="ganttChart"></div>
    </div>

    <script>
        let chartInstance = null;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ç–∞–∫ –∫–∞–∫ –∏–Ω–ø—É—Ç—ã —É–¥–∞–ª–µ–Ω—ã)
        const config = {
            chartHeight: null, // null = –∞–≤—Ç–æ-–≤—ã—Å–æ—Ç–∞
            projectName: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∑–¥–∞–Ω–∏—è MKL",
            startDate: new Date(), // –°–µ–≥–æ–¥–Ω—è
            theme: 'light',
            primaryColor: '#667eea'
        };

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
        let projectData = [
            {
                name: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞',
                id: 'phase_design',
                color: '#e0e0e0'
            },
            {
                name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏ –¢–ó',
                parent: 'phase_design',
                start: 0,
                end: 1,
                color: '#546E7A',
                completed: 0.15
            },
            {
                name: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ö–ú/–ö–ú–î',
                parent: 'phase_design',
                start: 1,
                end: 4,
                color: '#546E7A',
                dependency: 'task_prod'
            },
            {
                name: '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ –°–Ω–∞–±–∂–µ–Ω–∏–µ',
                id: 'phase_supply',
                color: '#e0e0e0'
            },
            {
                id: 'task_prod',
                name: '–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π',
                parent: 'phase_supply',
                start: 4,
                end: 14,
                color: '#0D47A1'
            },
            {
                name: '–î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç',
                parent: 'phase_supply',
                start: 14,
                end: 16,
                color: '#00796B',
                dependency: 'task_frame'
            },
            {
                name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                id: 'phase_build',
                color: '#e0e0e0'
            },
            {
                id: 'task_frame',
                name: '–ú–æ–Ω—Ç–∞–∂ –º–µ—Ç–∞–ª–ª–æ–∫–∞—Ä–∫–∞—Å–∞',
                parent: 'phase_build',
                start: 16,
                end: 26,
                color: '#EF6C00'
            },
            {
                name: '–ú–æ–Ω—Ç–∞–∂ —Å—ç–Ω–¥–≤–∏—á-–ø–∞–Ω–µ–ª–µ–π',
                parent: 'phase_build',
                start: 26,
                end: 36,
                color: '#EF6C00'
            },
            {
                name: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–æ—Ç –∏ –æ–∫–æ–Ω',
                parent: 'phase_build',
                start: 36,
                end: 41,
                color: '#EF6C00',
                dependency: 'task_handover'
            },
            {
                id: 'task_handover',
                name: '–°–¥–∞—á–∞ –æ–±—ä–µ–∫—Ç–∞',
                start: 43,
                end: 43,
                milestone: true,
                color: '#00796B'
            }
        ];

        function convertToGanttData() {
            const day = 1000 * 60 * 60 * 24;
            const startTimestamp = config.startDate.getTime();
            
            return projectData.map(task => {
                // –ï—Å–ª–∏ –µ—Å—Ç—å start/end –≤ –¥–Ω—è—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ timestamp
                if (task.start !== undefined && task.end !== undefined) {
                    return {
                        ...task,
                        start: startTimestamp + (task.start * day),
                        end: startTimestamp + (task.end * day)
                    };
                }
                return task;
            });
        }

                // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Å–µ–π (–°–∫—Ä—ã—Ç—å/–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å–ª–µ–≤–∞)
        function toggleAxis() {
            isCompactMode = !isCompactMode;
            const btn = document.getElementById('toggleAxisBtn');
            
            if (isCompactMode) {
                btn.textContent = "‚û° –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫";
                btn.classList.add('active');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ä—Ç: —Å–∫—Ä—ã–≤–∞–µ–º –æ—Å—å Y –∏ —Å–µ—Ç–∫—É
                chartInstance.update({
                    yAxis: {
                        labels: { enabled: false },
                        visible: false // –°–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–º—É –æ—Å—å –∏ –ø–æ–¥–ø–∏—Å–∏
                    },
                    chart: {
                        marginLeft: 10 // –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞
                    }
                });
            } else {
                btn.textContent = "‚¨Ö –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫";
                btn.classList.remove('active');
                
                chartInstance.update({
                    yAxis: {
                        labels: { enabled: true },
                        visible: true
                    },
                    chart: {
                        marginLeft: null // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ-–æ—Ç—Å—Ç—É–ø
                    }
                });
            }
        }

                function initChart() {
            chartInstance = Highcharts.ganttChart('ganttChart', {
                chart: {
                    backgroundColor: '#FFFFFF',
                    style: { fontFamily: "'Inter', sans-serif" },
                    // scrollablePlotArea –≤–∫–ª—é—á–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª Highcharts, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–Ω–æ–≥–æ
                    scrollablePlotArea: {
                        minHeight: 500, // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞
                        scrollPositionY: 0
                    }
                },
                title: { text: null },
                credits: { enabled: false },
                
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è (—Å–∫—Ä–æ–ª–ª–±–∞—Ä —Å–ø—Ä–∞–≤–∞)
                scrollbar: { enabled: true },
                navigator: { enabled: true, height: 30 },
                
                xAxis: {
                    currentDateIndicator: {
                        color: '#EF6C00',
                        width: 2,
                        label: {
                            format: '–°–µ–≥–æ–¥–Ω—è',
                            style: { color: '#EF6C00', fontWeight: 'bold' }
                        }
                    },
                    grid: { borderColor: '#ECEFF1' },
                    labels: { style: { color: '#546E7A' } }
                },

                yAxis: {
                    grid: { borderColor: '#ECEFF1' },
                    labels: {
                        style: { 
                            color: '#212121', 
                            fontSize: '13px', 
                            textOverflow: 'ellipsis' 
                        }
                    }
                },

                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#CFD8DC',
                    borderRadius: 4,
                    shadow: true,
                    style: { color: '#212121' },
                    dateTimeLabelFormats: {
                        day: '%e %b',
                        week: '%e %b'
                    }
                },

                series: [{
                    name: '–ü—Ä–æ–µ–∫—Ç',
                    data: seriesData,
                    borderColor: 'rgba(0,0,0,0.1)',
                    borderWidth: 1
                }],
                
                rangeSelector: {
                    enabled: true,
                    selected: 1, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 3 –º–µ—Å—è—Ü–∞
                    buttonTheme: {
                        fill: 'none',
                        stroke: 'none',
                        'stroke-width': 0,
                        r: 4,
                        style: { color: '#0D47A1', fontWeight: 'bold' },
                        states: { hover: { fill: '#E3F2FD' }, select: { fill: '#0D47A1', style: { color: 'white' } } }
                    },
                    buttons: [
                        { type: 'month', count: 1, text: '1 –º–µ—Å' },
                        { type: 'month', count: 3, text: '3 –º–µ—Å' }
                    ]
                }
            });
        }


        function updateChart() {
            const ganttData = convertToGanttData();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª–µ–π
            const backgroundColor = 'transparent';
            const textColor = '#212121';
            const gridColor = 'rgba(0,0,0,0.1)';

            chartInstance = Highcharts.ganttChart('ganttChart', {
                chart: {
                    // height: config.chartHeight, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞
                    backgroundColor: backgroundColor,
                    style: { fontFamily: "'Segoe UI', sans-serif" }
                },
                title: {
                    text: config.projectName,
                    style: { 
                        fontSize: '24px', 
                        fontWeight: 'bold', 
                        color: textColor 
                    }
                },
                xAxis: [{
                    currentDateIndicator: {
                        color: config.primaryColor,
                        dashStyle: 'ShortDot',
                        width: 3,
                        label: {
                            format: '–°–µ–≥–æ–¥–Ω—è',
                            style: { color: config.primaryColor, fontWeight: 'bold' }
                        }
                    },
                    grid: { 
                        borderWidth: 1, 
                        borderColor: gridColor 
                    }
                }],
                yAxis: {
                    uniqueNames: true,
                    grid: {
                        enabled: true,
                        borderColor: gridColor,
                        borderWidth: 1
                    },
                    labels: {
                        style: { color: textColor, fontSize: '13px', fontWeight: '500' }
                    }
                },
                tooltip: {
                    pointFormat: '<span>{point.name}</span><br/>' +
                        '–ù–∞—á–∞–ª–æ: <b>{point.start:%e %b}</b><br/>' +
                        '–ö–æ–Ω–µ—Ü: <b>{point.end:%e %b}</b>',
                    style: { fontSize: '12px' }
                },
                plotOptions: {
                    series: {
                        animation: { duration: 800 },
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}',
                            style: {
                                color: 'white',
                                textOutline: 'none',
                                fontWeight: 'normal'
                            }
                        }
                    }
                },
                series: [{
                    name: config.projectName,
                    data: ganttData
                }],
                navigator: { enabled: true },
                scrollbar: { enabled: true },
                rangeSelector: {
                    enabled: true,
                    buttons: [
                        { type: 'month', count: 1, text: '1 –º–µ—Å' },
                        { type: 'month', count: 3, text: '3 –º–µ—Å' },
                        { type: 'all', text: '–í—Å–µ' }
                    ],
                    selected: 2
                },
                credits: { enabled: false }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            updateChart();
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–∞–π–∑ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            if(chartInstance) chartInstance.reflow();
        });

        // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –º–æ–¥–∞–ª–∫–∞)
        window.addEventListener('message', function(event) {
             if (event.data.type === 'UPDATE_DATA') {
                 // –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                 if(event.data.projectData) {
                     projectData = event.data.projectData;
                 }
                 if(event.data.projectName) {
                     config.projectName = event.data.projectName;
                 }
                 updateChart();
             }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ Pro - –ü—Ä–æ—Å–º–æ—Ç—Ä</title>
    
    <!-- Highcharts -->
    <script src="js/highcharts.js"></script>
    <script src="js/gantt.js"></script>
    <script src="js/exporting.js"></script>
    <script src="js/modules/export-data.js"></script>
    <script src="js/accessibility.js"></script>
    
    <style>
        :root {
            --primary-blue: #0D47A1;
            --accent-teal: #00796B;
            --accent-orange: #EF6C00;
            --background-white: #FFFFFF;
            --text-primary: #212121;
            --text-secondary: #546E7A;
            --font-main: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            /* –°–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∏–ª—é */
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-teal) 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        /* –≠–∫—Ä–∞–Ω "–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" */
        #orientation-lock {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-blue);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #orientation-lock .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: rotate-phone 2s infinite ease-in-out;
        }

        @keyframes rotate-phone {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(0deg); }
        }

        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        @media screen and (max-width: 600px) and (orientation: portrait) {
            #orientation-lock { display: flex; }
            .container { display: none; }
        }
        
        /* –ö–Ω–æ–ø–∫–∞ "–Ø –≤—Å–µ —Ä–∞–≤–Ω–æ —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–∫" */
        .force-view-btn {
            margin-top: 20px;
            padding: 10px 20px;
            border: 1px solid white;
            background: transparent;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--font-main);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            background: var(--background-white);
            border-radius: 8px; /* –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ —É–≥–ª—ã */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            /* –í—ã—Å–æ—Ç–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ —ç–∫—Ä–∞–Ω–∞ –º–∏–Ω—É—Å –æ—Ç—Å—Ç—É–ø—ã */
            height: calc(100vh - 20px); 
            overflow: hidden;
            position: relative;
        }

        .header {
            background: var(--background-white);
            border-bottom: 1px solid #CFD8DC;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 18px;
            color: var(--primary-blue);
            font-weight: 700;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            display: flex;
            gap: 10px;
        }

        .btn-toggle {
            background: var(--background-light);
            border: 1px solid var(--primary-blue);
            color: var(--primary-blue);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-toggle:hover, .btn-toggle.active {
            background: var(--primary-blue);
            color: white;
        }

        /* –û–±–ª–∞—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–∞ */
        #ganttChart {
            flex-grow: 1;
            width: 100%;
            /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
            overflow-y: auto; 
            overflow-x: hidden;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 10px; align-items: flex-start; }
            .header h1 { font-size: 16px; }
            .controls { width: 100%; justify-content: space-between; }
            .btn-toggle { flex-grow: 1; text-align: center; }
        }
    </style>
</head>
<body>

    <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
    <div id="orientation-lock">
        <div class="icon">üì± ‚û°Ô∏è üîÑ</div>
        <h2>–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
        <p>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç –ª—É—á—à–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏.</p>
        <button class="force-view-btn" onclick="document.getElementById('orientation-lock').style.display='none'; document.querySelector('.container').style.display='flex';">
            –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ —Ä–∞–≤–Ω–æ
        </button>
    </div>

    <div class="container">
        <!-- 1. –í–ï–†–ù–£–õ –®–ê–ü–ö–£ –° –ö–ù–û–ü–ö–û–ô -->
        <header class="header">
            <h1>–ì—Ä–∞—Ñ–∏–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h1>
            <div class="controls">
                <button class="btn-toggle" id="toggleAxisBtn" onclick="toggleAxis()">‚¨Ö –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</button>
            </div>
        </header>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ -->
        <div id="ganttChart"></div>
    </div>

    <script>
        let chartInstance = null;
        let isCompactMode = false;

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
        const projectData = [
            { name: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞', id: 'phase_design', color: '#CFD8DC' },
            { name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏ –¢–ó', parent: 'phase_design', start: 0, end: 1, color: '#546E7A', completed: 0.15 },
            { name: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ö–ú/–ö–ú–î', parent: 'phase_design', start: 1, end: 4, color: '#546E7A', dependency: 'task_prod' },
            { name: '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', id: 'phase_supply', color: '#CFD8DC' },
            { id: 'task_prod', name: '–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ', parent: 'phase_supply', start: 4, end: 14, color: '#0D47A1' },
            { name: '–î–æ—Å—Ç–∞–≤–∫–∞', parent: 'phase_supply', start: 14, end: 16, color: '#00796B', dependency: 'task_frame' },
            { name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ', id: 'phase_build', color: '#CFD8DC' },
            { id: 'task_frame', name: '–ú–æ–Ω—Ç–∞–∂ –∫–∞—Ä–∫–∞—Å–∞', parent: 'phase_build', start: 16, end: 26, color: '#EF6C00' },
            { name: '–°—ç–Ω–¥–≤–∏—á-–ø–∞–Ω–µ–ª–∏', parent: 'phase_build', start: 26, end: 36, color: '#EF6C00' },
            { name: '–í–æ—Ä–æ—Ç–∞ –∏ –æ–∫–Ω–∞', parent: 'phase_build', start: 36, end: 41, color: '#EF6C00', dependency: 'task_handover' },
            { id: 'task_handover', name: '–°–¥–∞—á–∞ –æ–±—ä–µ–∫—Ç–∞', start: 43, end: 43, milestone: true, color: '#00796B' }
        ];

        // 2. –ò–°–ü–†–ê–í–õ–ï–ù–ê –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–•
        function getPreparedData() {
            const day = 1000 * 60 * 60 * 24;
            const startTimestamp = new Date().getTime(); // –°–µ–≥–æ–¥–Ω—è
            
            return projectData.map(task => {
                if (task.start !== undefined && task.end !== undefined) {
                    return {
                        ...task,
                        start: startTimestamp + (task.start * day),
                        end: startTimestamp + (task.end * day)
                    };
                }
                return task;
            });
        }

        // 3. –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –û–°–ï–ô
        function toggleAxis() {
            isCompactMode = !isCompactMode;
            const btn = document.getElementById('toggleAxisBtn');
            
            if (isCompactMode) {
                btn.textContent = "‚û° –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫";
                btn.classList.add('active');
                
                chartInstance.update({
                    yAxis: { visible: false, labels: { enabled: false } }, // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å—å
                    chart: { marginLeft: 10 }
                });
            } else {
                btn.textContent = "‚¨Ö –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫";
                btn.classList.remove('active');
                
                chartInstance.update({
                    yAxis: { visible: true, labels: { enabled: true } }, // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å—å
                    chart: { marginLeft: null }
                });
            }
        }

        // 4. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø (–° –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å–∫—Ä–æ–ª–ª–∞)
        function initChart() {
            const seriesData = getPreparedData();

            chartInstance = Highcharts.ganttChart('ganttChart', {
                chart: {
                    backgroundColor: '#FFFFFF',
                    style: { fontFamily: "'Inter', sans-serif" },
                    // –í–ê–ñ–ù–û: –í–∫–ª—é—á–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª Highcharts, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–µ–∑–∞–µ—Ç
                    scrollablePlotArea: {
                        minHeight: 600, // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ –º–µ–Ω—å—à–µ 600px, –≤–∫–ª—é—á–∏—Ç—Å—è —Å–∫—Ä–æ–ª–ª
                        scrollPositionY: 0,
                        opacity: 0.85
                    }
                },
                title: { text: null },
                credits: { enabled: false },
                
                xAxis: {
                    currentDateIndicator: {
                        color: '#EF6C00',
                        width: 2,
                        label: { format: '–°–µ–≥–æ–¥–Ω—è', style: { color: '#EF6C00' } }
                    },
                    grid: { borderColor: '#ECEFF1' },
                    labels: { style: { color: '#546E7A' } }
                },

                yAxis: {
                    uniqueNames: true,
                    grid: { borderColor: '#ECEFF1' },
                    labels: {
                        style: { color: '#212121', fontSize: '13px' }
                    }
                },

                plotOptions: {
                    series: {
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}',
                            style: { fontWeight: 'normal', textOutline: 'none' }
                        }
                    }
                },

                series: [{
                    name: '–ü—Ä–æ–µ–∫—Ç',
                    data: seriesData,
                    borderColor: 'rgba(0,0,0,0.1)'
                }],
                
                navigator: { enabled: true, height: 40 },
                scrollbar: { enabled: true },
                rangeSelector: {
                    enabled: true,
                    selected: 1,
                    buttons: [
                        { type: 'month', count: 1, text: '1 –º–µ—Å' },
                        { type: 'month', count: 3, text: '3 –º–µ—Å' },
                        { type: 'all', text: '–í—Å–µ' }
                    ]
                }
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', initChart);

        // –†–µ—Å–∞–π–∑
        window.addEventListener('resize', () => {
            if(chartInstance) chartInstance.reflow();
        });
    </script>
</body>
</html>

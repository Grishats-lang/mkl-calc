<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ Pro - –ü—Ä–æ—Å–º–æ—Ç—Ä</title>
    
    <!-- Highcharts -->
    <script src="js/gantt.js"></script>
    <script src="js/modules/export-data.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh; /* –ß—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞–ª–æ –ø–æ—á—Ç–∏ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
        }

        #ganttChart {
            padding: 20px;
            flex-grow: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            width: 100%;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∞–ø–æ–≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h1>           
        </div>

        <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞ -->
        <div id="ganttChart"></div>
    </div>

    <script>
        let chartInstance = null;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ç–∞–∫ –∫–∞–∫ –∏–Ω–ø—É—Ç—ã —É–¥–∞–ª–µ–Ω—ã)
        const config = {
            chartHeight: null, // null = –∞–≤—Ç–æ-–≤—ã—Å–æ—Ç–∞
            projectName: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∑–¥–∞–Ω–∏—è MKL",
            startDate: new Date(), // –°–µ–≥–æ–¥–Ω—è
            theme: 'light',
            primaryColor: '#667eea'
        };

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
        let projectData = [
            {
                name: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞',
                id: 'phase_design',
                color: '#e0e0e0'
            },
            {
                name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏ –¢–ó',
                parent: 'phase_design',
                start: 0,
                end: 1,
                color: '#546E7A',
                completed: 0.15
            },
            {
                name: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ö–ú/–ö–ú–î',
                parent: 'phase_design',
                start: 1,
                end: 4,
                color: '#546E7A',
                dependency: 'task_prod'
            },
            {
                name: '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ –°–Ω–∞–±–∂–µ–Ω–∏–µ',
                id: 'phase_supply',
                color: '#e0e0e0'
            },
            {
                id: 'task_prod',
                name: '–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π',
                parent: 'phase_supply',
                start: 4,
                end: 14,
                color: '#0D47A1'
            },
            {
                name: '–î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç',
                parent: 'phase_supply',
                start: 14,
                end: 16,
                color: '#00796B',
                dependency: 'task_frame'
            },
            {
                name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                id: 'phase_build',
                color: '#e0e0e0'
            },
            {
                id: 'task_frame',
                name: '–ú–æ–Ω—Ç–∞–∂ –º–µ—Ç–∞–ª–ª–æ–∫–∞—Ä–∫–∞—Å–∞',
                parent: 'phase_build',
                start: 16,
                end: 26,
                color: '#EF6C00'
            },
            {
                name: '–ú–æ–Ω—Ç–∞–∂ —Å—ç–Ω–¥–≤–∏—á-–ø–∞–Ω–µ–ª–µ–π',
                parent: 'phase_build',
                start: 26,
                end: 36,
                color: '#EF6C00'
            },
            {
                name: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–æ—Ç –∏ –æ–∫–æ–Ω',
                parent: 'phase_build',
                start: 36,
                end: 41,
                color: '#EF6C00',
                dependency: 'task_handover'
            },
            {
                id: 'task_handover',
                name: '–°–¥–∞—á–∞ –æ–±—ä–µ–∫—Ç–∞',
                start: 43,
                end: 43,
                milestone: true,
                color: '#00796B'
            }
        ];

        function convertToGanttData() {
            const day = 1000 * 60 * 60 * 24;
            const startTimestamp = config.startDate.getTime();
            
            return projectData.map(task => {
                // –ï—Å–ª–∏ –µ—Å—Ç—å start/end –≤ –¥–Ω—è—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ timestamp
                if (task.start !== undefined && task.end !== undefined) {
                    return {
                        ...task,
                        start: startTimestamp + (task.start * day),
                        end: startTimestamp + (task.end * day)
                    };
                }
                return task;
            });
        }

        function updateChart() {
            const ganttData = convertToGanttData();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª–µ–π
            const backgroundColor = 'transparent';
            const textColor = '#212121';
            const gridColor = 'rgba(0,0,0,0.1)';

            chartInstance = Highcharts.ganttChart('ganttChart', {
                chart: {
                    // height: config.chartHeight, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞
                    backgroundColor: backgroundColor,
                    style: { fontFamily: "'Segoe UI', sans-serif" }
                },
                title: {
                    text: config.projectName,
                    style: { 
                        fontSize: '24px', 
                        fontWeight: 'bold', 
                        color: textColor 
                    }
                },
                xAxis: [{
                    currentDateIndicator: {
                        color: config.primaryColor,
                        dashStyle: 'ShortDot',
                        width: 3,
                        label: {
                            format: '–°–µ–≥–æ–¥–Ω—è',
                            style: { color: config.primaryColor, fontWeight: 'bold' }
                        }
                    },
                    grid: { 
                        borderWidth: 1, 
                        borderColor: gridColor 
                    }
                }],
                yAxis: {
                    uniqueNames: true,
                    grid: {
                        enabled: true,
                        borderColor: gridColor,
                        borderWidth: 1
                    },
                    labels: {
                        style: { color: textColor, fontSize: '13px', fontWeight: '500' }
                    }
                },
                tooltip: {
                    pointFormat: '<span>{point.name}</span><br/>' +
                        '–ù–∞—á–∞–ª–æ: <b>{point.start:%e %b}</b><br/>' +
                        '–ö–æ–Ω–µ—Ü: <b>{point.end:%e %b}</b>',
                    style: { fontSize: '12px' }
                },
                plotOptions: {
                    series: {
                        animation: { duration: 800 },
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}',
                            style: {
                                color: 'white',
                                textOutline: 'none',
                                fontWeight: 'normal'
                            }
                        }
                    }
                },
                series: [{
                    name: config.projectName,
                    data: ganttData
                }],
                navigator: { enabled: true },
                scrollbar: { enabled: true },
                rangeSelector: {
                    enabled: true,
                    buttons: [
                        { type: 'month', count: 1, text: '1 –º–µ—Å' },
                        { type: 'month', count: 3, text: '3 –º–µ—Å' },
                        { type: 'all', text: '–í—Å–µ' }
                    ],
                    selected: 2
                },
                credits: { enabled: false }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            updateChart();
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–∞–π–∑ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            if(chartInstance) chartInstance.reflow();
        });

        // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –º–æ–¥–∞–ª–∫–∞)
        window.addEventListener('message', function(event) {
             if (event.data.type === 'UPDATE_DATA') {
                 // –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                 if(event.data.projectData) {
                     projectData = event.data.projectData;
                 }
                 if(event.data.projectName) {
                     config.projectName = event.data.projectName;
                 }
                 updateChart();
             }
        });
    </script>
</body>

</html>
